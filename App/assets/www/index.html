<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="stylesheets/episopass.css" type="text/css">
    <link rel="stylesheet" href="stylesheets/jquery-ui.css" type="text/css">

    <script language="JavaScript" src="javascripts/jquery.js"></script>
    <script language="JavaScript" src="javascripts/md5.js"></script>
    <script language="JavaScript" src="javascripts/crypt.js"></script>
    <script language="JavaScript" src="javascripts/data.js"></script>
    <script language="JavaScript" src="javascripts/app.js"></script>
    <script language="JavaScript" src="javascripts/jquery-ui.js"></script>

    <script type="text/javascript" src="cordova.js"></script>
<!--
    <script language="JavaScript" src="javascripts/index.js"></script>
-->

    <script language="JavaScript">
      /*
      JSONを格納する /EpisoPass/qa.json というファイルを読むのにFileReader()というのを
      使おうとしたら index.js, cordova.js のプラグインとかが必要になってしまい、
      android.permission.ACCESS_NETWORK_STATE
      をAndroidManifest.xmlに指定しなければならなくなってしまった。
      こういうのナシでファイル読む方法を考えるべき
      */
    $(function(){
            //app.initialize();

	    document.addEventListener("deviceready", onDeviceReady, false);

	    function onDeviceReady() {
	        console.log("Device Ready---------------");
                window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
	    }

	    function gotFS(fileSystem) {
                //fileSystem.root.getFile("readme.txt", {create: true, exclusive: false}, gotFileEntry, fail);
	        fileSystem.root.getDirectory("EpisoPass", {create: false, exclusive: false}, onGetDirectoryWin, onGetDirectoryFail);
	    }

	    var onGetDirectoryWin = function(parent) {
	       console.log("onGetDirectoryWin");
	       parent.getFile("qa.json", {create: true, exclusive: false}, gotFileEntry, fail);
	    }
	    var onGetDirectoryFail = function() {
	       console.log("error getting dir")
	    }

	    function gotFileEntry(fileEntry) {
               fileEntry.file(gotFile, fail);
	    }

	    function gotFile(file){
                var reader = new FileReader();
                reader.onloadend = function(evt) {
                   console.log("Read as text");
                   console.log(evt.target.result);
                   //alert(evt.target.result);

	         json = evt.target.result;

	           init();
                };
                reader.readAsText(file);
	    }

            function fail(error) {
               console.log(error.code);
            }
    })
    </script>

    <title>EpisoPass</title>
  </head>
  <body>
         <div class="app">
            <div id="deviceready" class="blink">
                <p class="event listening"></p>
                <p class="event received"></p>
            </div>
        </div>

  </body>
</html>

